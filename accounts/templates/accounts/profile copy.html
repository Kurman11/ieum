{% extends 'base.html' %}
{% load static %}

{% block title %} {{ person.username }}님의 프로필 {% endblock title %}
{% block style %}
{% endblock style %}
{% block content %}
<h2>{{ person.username }}님 안녕하세요</h2>

<form method="GET" action="{% url 'accounts:search_spotify' %}">
  <input type="text" name="q" placeholder="검색어를 입력하세요">
  <button type="submit">검색</button>
</form>


{% if tracks %}
  <ul>
    <form method="POST" action="{% url 'accounts:save_track' %}">
      {% csrf_token %}
      {% for track in tracks %}
        <li id="track-{{ forloop.counter }}">
          <img style="width:50px;" src="{{ track.album.images.0.url }}" alt="{{ track.album.name }}">
          <span>{{ track.name }}</span>
          <a href="#" class="play-track" data-src="{{ track.preview_url }}">재생</a>
          <input type="checkbox" name="selected_tracks[]" value="{{ track.id }}">
          <button type="submit">저장</button>
        </li>
        {% endfor %}
    </form>
  </ul>
  <audio id="audio-player" controls>
    <source src="" type="audio/mp3">
  </audio>
{% endif %}



<script>

  document.addEventListener('DOMContentLoaded', function() {
    var audioPlayer = document.getElementById('audio-player');
    var playLinks = document.querySelectorAll('.play-track');

    playLinks.forEach(function(link) {
      link.addEventListener('click', function(e) {
        e.preventDefault();

        var audioSrc = this.getAttribute('data-src');
        audioPlayer.setAttribute('src', audioSrc);
        audioPlayer.play();

        // 선택한 노래를 제외한 나머지 리스트 숨김
        var selectedTrackId = this.parentNode.id;
        var trackList = document.getElementsByTagName('li');
        for (var i = 0; i < trackList.length; i++) {
          if (trackList[i].id !== selectedTrackId) {
            trackList[i].style.display = 'none';
          }
        }
      });
    });
  });


  document.addEventListener('DOMContentLoaded', function() {
    // 오디오 플레이어 요소를 가져옵니다.
    var audioPlayer = document.getElementById('audio-player');
  
    // "재생" 링크를 모두 가져옵니다.
    var playLinks = document.querySelectorAll('.play-track');
  
    // 각 "재생" 링크에 클릭 이벤트 리스너를 추가합니다.
    playLinks.forEach(function(link) {
      link.addEventListener('click', function(e) {
        e.preventDefault();
  
        // 오디오 소스 URL을 가져와서 오디오 플레이어에 설정합니다.
        var audioSrc = this.getAttribute('data-src');
        audioPlayer.setAttribute('src', audioSrc);
  
        // 볼륨을 반으로 설정합니다.
        audioPlayer.volume = 0.5;
  
        // 오디오를 재생합니다.
        audioPlayer.play();
      });
    });
  });


  document.addEventListener('DOMContentLoaded', function() {
    var saveButtons = document.querySelectorAll('.save-button');

    saveButtons.forEach(function(button) {
      button.addEventListener('click', function() {
        var trackId = this.parentElement.getAttribute('data-track-id');
        var form = document.querySelector('form[action="{% url 'accounts:save_track' %}"]');

        form.setAttribute('action', form.getAttribute('action') + trackId);
        form.submit();
      });
    });
  });
</script>
{% endblock content %}
{% block script %}
{% endblock script %}